#
# Copyright 2016 Blockie AB
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
---
@clone: os

_info:
    title: Docker container management.

_dep_install:
    _info:
        title: Verify dependencies for this module.
        desc: |
            If docker is not already installed it will
            download and install the latest Docker Engine from Docker and
            add the targetuser to the docker group.
    _env:
        - targetuser: ${targetuser:-${SSHUSER:-$USER}}
        - RUN: DOCKER_DEP_INSTALL -- "${targetuser}"

install:
    _info:
        title: Install the latest Docker Engine.
        desc: |
            Downloads and installs the latest Docker Engine from Docker.
            Also adds the targetuser to the docker group.
            Will reinstall if already installed.
    _env:
        - targetuser: ${targetuser:-${SSHUSER:-$USER}}
        - RUN: DOCKER_INSTALL -- "${targetuser}"

run:
    _info:
        title: Run a container
    _env:
        - RUN: DOCKER_RUN -- "${image-}" "${container-}" "${flags-}" "${cmd-}" "${args-}"

ls_by_status:
    _info:
        title: List container(s) by their status
    _env:
        - status: ${status:-Up}
        - RUN: DOCKER_LS_BY_STATUS -- "${status}"

rm_by_status:
    _info:
        title: Remove container(s) by their status
    _env:
        - status: ${status:-Exited}
        - RUN: DOCKER_RM_BY_STATUS -- "${status}"

rm_by_id:
    _info:
        title: Remove container(s) by their id
    _env:
        - ids:
        - RUN: DOCKER_RM_BY_ID -- "${ids}"

rmi_all:
    _info:
        title: Remove all docker images
    _env:
        - RUN: DOCKER_RMI_ALL

enter:
    _info:
        title: Enter a running container.
    _env:
        - container: ${container-}
        - shell: ${shell-}
        - RUN: DOCKER_ENTER -- "${container-}" "${shell-}"

ps:
    _info:
        title: List containers.
    _env:
        - RUN: DOCKER_PS

exec_wrap:
    _info:
        title: Exec a command inside an existing container
    _env:
        - SPACE_WRAP: DOCKER_EXEC_WRAP

run_wrap:
    _info:
        title: Exec a command inside a temporary container
    _env:
        - image: alpine
        - flags: "--rm -ti"
        - SPACE_WRAP: DOCKER_RUN_WRAP
...
